<div class="editor-container">
  <mat-card class="info-card">
    <mat-card-content>
      <div class="info-row">
        <div class="info-item" *ngIf="repoInfo">
          <mat-icon>folder</mat-icon>
          <span>{{ repoInfo.owner }}/{{ repoInfo.name }}</span>
        </div>
        <div class="info-item" *ngIf="repoInfo">
          <mat-icon>insert_drive_file</mat-icon>
          <span>{{ repoInfo.filePath }}</span>
        </div>
        <div class="info-item" *ngIf="repoInfo">
          <mat-icon>account_tree</mat-icon>
          <span>{{ repoInfo.branch }}</span>
        </div>
        <div class="spacer"></div>
        <mat-chip *ngIf="hasUnsavedChanges" color="warn" highlighted>
          <mat-icon>warning</mat-icon>
          Unsaved Changes
        </mat-chip>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="editor-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>edit</mat-icon>
        Rule Editor
        <span class="rule-count" *ngIf="rulesData">({{ rulesData.ruleTable.rules.length }} rules)</span>
      </mat-card-title>
      <div class="spacer"></div>
      <div class="header-actions">
        <div class="button-group">
          <span class="group-label">Grid Operations</span>
          <div class="button-row">
            <button mat-raised-button (click)="addRow()" [disabled]="!rulesData">
              <mat-icon>add</mat-icon>
              Add Row
            </button>
            <button mat-raised-button (click)="deleteSelectedRow()" [disabled]="!rulesData || !selectedRowId">
              <mat-icon>remove</mat-icon>
              Delete Row
            </button>
            <button mat-raised-button (click)="openAddColumnDialog()" [disabled]="!rulesData">
              <mat-icon>view_column</mat-icon>
              Add Column
            </button>
            <button mat-raised-button (click)="deleteColumn()" [disabled]="!rulesData">
              <mat-icon>view_column</mat-icon>
              Delete Column
            </button>
          </div>
        </div>

        <div class="button-group">
          <span class="group-label">Git Operations</span>
          <div class="button-row">
            <button mat-raised-button color="primary" (click)="pullFromGit()" [disabled]="!rulesData">
              <mat-icon>cloud_download</mat-icon>
              Pull
            </button>
            <button mat-raised-button color="accent" (click)="saveLocally()" [disabled]="!hasUnsavedChanges">
              <mat-icon>save</mat-icon>
              Save
            </button>
            <button mat-raised-button color="accent" (click)="openPushDialog()" 
                    [disabled]="!hasSavedData || !repoInfo?.hasToken">
              <mat-icon>cloud_upload</mat-icon>
              Push
            </button>
          </div>
        </div>
      </div>
    </mat-card-header>
    <mat-card-content>
      <div class="grid-container">
        <ag-grid-angular
          class="ag-theme-material"
          [columnDefs]="columnDefs"
          [rowData]="rowData"
          [defaultColDef]="defaultColDef"
          [rowSelection]="'single'"
          (gridReady)="onGridReady($event)"
          (cellValueChanged)="onCellValueChanged($event)"
          (selectionChanged)="onSelectionChanged()"
          [domLayout]="'autoHeight'"
        >
        </ag-grid-angular>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="metadata-card" *ngIf="rulesData">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info</mat-icon>
        Metadata
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="metadata-row">
        <strong>RuleSet:</strong> {{ rulesData.metadata.ruleSet }}
      </div>
      <div class="metadata-row">
        <strong>Imports:</strong> {{ rulesData.metadata.imports.join(', ') }}
      </div>
      <div class="metadata-row" *ngIf="rulesData.metadata.variables.length > 0">
        <strong>Variables:</strong> {{ rulesData.metadata.variables.join(', ') }}
      </div>
      <div class="metadata-row" *ngIf="rulesData.metadata.notes">
        <strong>Notes:</strong> {{ rulesData.metadata.notes }}
      </div>
    </mat-card-content>
  </mat-card>
</div>
